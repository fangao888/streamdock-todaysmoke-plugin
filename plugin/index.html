<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>今日抽烟插件</title>
</head>
<body>
    <div id="debug"></div>
    <script>
        // 添加一个简单的调试函数
        function debugLog(message) {
            console.log(message);
            var debugElement = document.getElementById('debug');
            if (debugElement) {
                debugElement.innerHTML += message + '<br>';
            }
        }
        
        // 实现 connectElgatoStreamDeckSocket 函数
        function connectElgatoStreamDeckSocket(inPort, inPluginUUID, inRegisterEvent, inInfo) {
            debugLog('connectElgatoStreamDeckSocket 被调用');
            debugLog('端口: ' + inPort);
            debugLog('插件 UUID: ' + inPluginUUID);
            debugLog('注册事件: ' + inRegisterEvent);
            debugLog('信息: ' + inInfo);

            // 创建 WebSocket 连接
            const socket = new WebSocket('ws://127.0.0.1:' + inPort);

            // 当连接打开时发送注册消息
            socket.onopen = function() {
                debugLog('WebSocket 连接已打开');
                socket.send(JSON.stringify({
                    event: inRegisterEvent,
                    uuid: inPluginUUID
                }));
            };

            // 处理接收到的消息
            socket.onmessage = function(event) {
                debugLog('收到消息: ' + event.data);
                // 在这里处理接收到的消息
                // 可以将消息传递给插件的主逻辑
            };

            // 错误处理
            socket.onerror = function(error) {
                debugLog('WebSocket 错误: ' + JSON.stringify(error));
            };

            // 连接关闭处理
            socket.onclose = function(event) {
                debugLog('WebSocket 连接已关闭: ' + event.code + ' ' + event.reason);
            };

            // 将 socket 对象存储在全局变量中，以便其他脚本可以使用
            window.streamDeckSocket = socket;
        }
    </script>
    <script src="./utils/common.js"></script>
    <script src="./utils/axios.js"></script>
    <script src="./index.js"></script>
    <script>
        debugLog('HTML 文档加载完成');
    </script>
</body>
</html>